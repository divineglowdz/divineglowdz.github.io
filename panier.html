<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Lumina Beauty • Formulaire de commande</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --fond: #f9f4ec;
      --accent: #c9a47a;
      --accent-light: #f2e3d2;
      --texte-principal: #3e2b24;
      --texte-secondaire: #7b6b59;
      --clair: #fffaf1;
      --ombre-douce: 0 20px 45px rgba(201, 164, 122, 0.18);
      --rouge-erreur: #d85454;
      --vert-succes: #4c9a75;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(145deg, var(--clair), var(--fond));
      color: var(--texte-principal);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: radial-gradient(circle at top left, #fffaf1 0%, #f5ebdd 55%, #ede0cf 100%);
      padding: 32px 5% 24px;
    }

    nav {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }

    nav .logo {
      display: block;
      width: 110px;
      max-width: 60vw;
    }

    nav .logo img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    nav a {
      color: var(--texte-principal);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }

    nav a:hover {
      color: var(--accent);
    }

    main {
      flex: 1;
      padding: 60px 5% 80px;
      display: flex;
      justify-content: center;
    }

    .form-section {
      width: min(960px, 100%);
      display: grid;
      gap: 24px;
    }

    .form-section h1 {
      font-size: clamp(2rem, 4vw, 2.6rem);
      text-align: center;
    }

    .form-intro {
      text-align: center;
      color: var(--texte-secondaire);
      max-width: 620px;
      margin: 0 auto;
    }

    .order-wrapper {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .card {
      background: var(--clair);
      border-radius: 22px;
      padding: 28px;
      box-shadow: 0 18px 38px rgba(62, 43, 36, 0.12);
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 100%;
    }

    form {
      display: grid;
      gap: 18px;
    }

    .field-group {
      display: grid;
      gap: 12px;
    }

    .field-row {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #e7dbc8;
      background: #ffffff;
      font-family: inherit;
      font-size: 0.95rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(201, 164, 122, 0.18);
      outline: none;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .delivery-options {
      display: grid;
      gap: 14px;
    }

    .delivery-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border: 1px solid #e7dbc8;
      border-radius: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .delivery-option input[type="radio"] {
      width: 18px;
      height: 18px;
      accent-color: var(--accent);
    }

    .delivery-option:hover {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(201, 164, 122, 0.12);
      background: #fff6eb;
    }

    .embedded-summary {
      margin-top: 10px;
      background: rgba(255, 250, 241, 0.75);
    }

    .order-summary {
      border: 1px solid rgba(201, 164, 122, 0.28);
      border-radius: 18px;
      padding: 20px;
      display: grid;
      gap: 16px;
    }

    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
    }

    .summary-list {
      display: grid;
      gap: 14px;
      list-style: none;
    }

    .summary-item {
      display: grid;
      grid-template-columns: 68px 1fr;
      gap: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(62, 43, 36, 0.08);
    }

    .summary-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .summary-thumb {
      width: 68px;
      height: 68px;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 12px 24px rgba(62, 43, 36, 0.18);
    }

    .summary-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .summary-info {
      display: grid;
      gap: 6px;
    }

    .summary-item-title {
      font-weight: 600;
    }

    .summary-meta {
      font-size: 0.9rem;
      color: var(--texte-secondaire);
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .totals-block {
      display: grid;
      gap: 6px;
      font-size: 0.95rem;
    }

    .totals-block span {
      display: flex;
      justify-content: space-between;
      gap: 16px;
    }

    .summary-total {
      font-weight: 700;
      font-size: 1.05rem;
      text-align: right;
    }

    .empty-cart-message {
      text-align: center;
      color: var(--rouge-erreur);
      font-size: 0.9rem;
      background: rgba(216, 84, 84, 0.08);
      border-radius: 12px;
      padding: 14px;
    }

    .submit-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn {
      padding: 14px 28px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease, color 0.2s ease;
    }

    .btn-principal {
      background: var(--accent);
      color: var(--clair);
      box-shadow: var(--ombre-douce);
    }

    .btn-principal:hover:enabled {
      transform: translateY(-3px);
      background: #ba8f60;
    }

    .btn-principal:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    footer {
      background: #3b2f23;
      color: #f0e3d1;
      padding: 40px 5%;
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    footer h4 {
      color: #fffaf1;
      margin-bottom: 14px;
      font-size: 1.1rem;
    }

    footer a {
      color: #f0e3d1;
      text-decoration: none;
    }

    footer a:hover {
      color: var(--accent-light);
    }

    .contact-chip {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      border-radius: 40px;
      background: rgba(255, 250, 241, 0.12);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.18);
      backdrop-filter: blur(4px);
      margin-bottom: 12px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .contact-chip svg {
      width: 18px;
      height: 18px;
      fill: var(--accent-light);
      stroke: var(--accent);
      stroke-width: 1.2;
    }

    .contact-chip:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.2);
    }

    .social-links {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .social-icon {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      border-radius: 999px;
      background: rgba(242, 227, 210, 0.15);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.22);
      color: #fffaf1;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    .social-icon svg {
      width: 22px;
      height: 22px;
      fill: none;
      stroke: #f8dcb7;
      stroke-width: 1.6;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .social-icon:hover {
      transform: translateY(-4px);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.28);
      background: rgba(242, 227, 210, 0.25);
    }

    .credits {
      grid-column: 1 / -1;
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.7;
      margin-top: 20px;
    }

    @media (max-width: 640px) {
      header {
        padding-bottom: 16px;
      }

      main {
        padding: 48px 5% 72px;
      }

      .card {
        padding: 22px;
      }

      .summary-item {
        grid-template-columns: 58px 1fr;
      }

      .summary-thumb {
        width: 58px;
        height: 58px;
      }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <a class="logo" href="index.html">
        <img src="https://i.ibb.co/k7R6BCs/Photo-Room-20251101-143835.png" alt="Logo Lumina Beauty">
      </a>
      <ul>
        <li><a href="boutique.html">Boutique</a></li>
        <li><a href="#formulaire-commande">Commande</a></li>
        <li><a href="#contact-footer">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main id="formulaire-commande">
    <section class="form-section">
      <h1>Formulaire de commande</h1>
      <p class="form-intro">
        Renseignez vos informations, vérifiez vos produits et le tarif de livraison. Nous confirmons la commande au plus vite.
      </p>

      <div class="order-wrapper">
        <form class="card" id="order-form" action="https://formsubmit.co/divineglowdz1@gmail.com" method="POST">
          <input type="hidden" name="_subject" value="Nouvelle commande Lumina Beauty">
          <input type="hidden" name="_template" value="box">
          <input type="hidden" name="_captcha" value="false">
          <input type="hidden" name="_autoresponse" value="Merci pour votre commande ! Nous vous contacterons très bientôt pour la confirmer.">
          <input type="hidden" name="_next" value="https://lumina-beauty.example.com/merci.html">

          <div class="field-row">
            <div class="field-group">
              <label for="prenom">Prénom</label>
              <input type="text" id="prenom" name="prenom" autocomplete="given-name" placeholder="Ex. Amel" required>
            </div>
            <div class="field-group">
              <label for="nom">Nom</label>
              <input type="text" id="nom" name="nom" autocomplete="family-name" placeholder="Ex. Bensaïd" required>
            </div>
          </div>

          <div class="field-group">
            <label for="telephone">Numéro de téléphone</label>
            <input type="tel" id="telephone" name="telephone" autocomplete="tel" placeholder="Ex. 0559 76 46 90" required>
          </div>

          <div class="field-row">
            <div class="field-group">
              <label for="wilaya">Wilaya</label>
              <select id="wilaya" name="wilaya" required>
                <option value="">-- Sélectionnez votre wilaya --</option>
                <option value="Adrar">01 - Adrar</option>
                <option value="Chlef">02 - Chlef</option>
                <option value="Laghouat">03 - Laghouat</option>
                <option value="Oum El Bouaghi">04 - Oum El Bouaghi</option>
                <option value="Batna">05 - Batna</option>
                <option value="Béjaïa">06 - Béjaïa</option>
                <option value="Biskra">07 - Biskra</option>
                <option value="Béchar">08 - Béchar</option>
                <option value="Blida">09 - Blida</option>
                <option value="Bouira">10 - Bouira</option>
                <option value="Tamanrasset">11 - Tamanrasset</option>
                <option value="Tébessa">12 - Tébessa</option>
                <option value="Tlemcen">13 - Tlemcen</option>
                <option value="Tiaret">14 - Tiaret</option>
                <option value="Tizi Ouzou">15 - Tizi Ouzou</option>
                <option value="Alger">16 - Alger</option>
                <option value="Djelfa">17 - Djelfa</option>
                <option value="Jijel">18 - Jijel</option>
                <option value="Sétif">19 - Sétif</option>
                <option value="Saïda">20 - Saïda</option>
                <option value="Skikda">21 - Skikda</option>
                <option value="Sidi Bel Abbès">22 - Sidi Bel Abbès</option>
                <option value="Annaba">23 - Annaba</option>
                <option value="Guelma">24 - Guelma</option>
                <option value="Constantine">25 - Constantine</option>
                <option value="Médéa">26 - Médéa</option>
                <option value="Mostaganem">27 - Mostaganem</option>
                <option value="M'Sila">28 - M'Sila</option>
                <option value="Mascara">29 - Mascara</option>
                <option value="Ouargla">30 - Ouargla</option>
                <option value="Oran">31 - Oran</option>
                <option value="El Bayadh">32 - El Bayadh</option>
                <option value="Illizi">33 - Illizi</option>
                <option value="Bordj Bou Arreridj">34 - Bordj Bou Arreridj</option>
                <option value="Boumerdès">35 - Boumerdès</option>
                <option value="El Tarf">36 - El Tarf</option>
                <option value="Tindouf">37 - Tindouf</option>
                <option value="Tissemsilt">38 - Tissemsilt</option>
                <option value="El Oued">39 - El Oued</option>
                <option value="Khenchela">40 - Khenchela</option>
                <option value="Souk Ahras">41 - Souk Ahras</option>
                <option value="Tipaza">42 - Tipaza</option>
                <option value="Mila">43 - Mila</option>
                <option value="Aïn Defla">44 - Aïn Defla</option>
                <option value="Naâma">45 - Naâma</option>
                <option value="Aïn Témouchent">46 - Aïn Témouchent</option>
                <option value="Ghardaïa">47 - Ghardaïa</option>
                <option value="Relizane">48 - Relizane</option>
                <option value="El M'ghair">49 - El M'ghair</option>
                <option value="El Menia">50 - El Menia</option>
                <option value="Ouled Djellal">51 - Ouled Djellal</option>
                <option value="Bordj Badji Mokhtar">52 - Bordj Badji Mokhtar</option>
                <option value="Béni Abbès">53 - Béni Abbès</option>
                <option value="Timimoun">54 - Timimoun</option>
                <option value="Touggourt">55 - Touggourt</option>
                <option value="Djanet">56 - Djanet</option>
                <option value="In Salah">57 - In Salah</option>
                <option value="In Guezzam">58 - In Guezzam</option>
              </select>
            </div>
            <div class="field-group">
              <label for="adresse">Adresse complète</label>
              <textarea id="adresse" name="adresse" placeholder="Immeuble, rue, numéro d’appartement, indications complémentaires…" required></textarea>
            </div>
          </div>

          <div class="field-group delivery-options">
            <span>Mode de livraison</span>
            <label class="delivery-option">
              <input type="radio" name="mode_livraison" value="Stop desk" required>
              <div>
                <strong>Stop desk (Bureau)</strong>
                <p class="helper-text">Retrait au bureau de livraison — tarif « Bureau ».</p>
              </div>
            </label>
            <label class="delivery-option">
              <input type="radio" name="mode_livraison" value="À domicile" required>
              <div>
                <strong>À domicile</strong>
                <p class="helper-text">Livraison à votre adresse — tarif « A domicile ».</p>
              </div>
            </label>
          </div>

          <div class="order-summary embedded-summary" aria-live="polite">
            <div class="summary-header">
              <h2>Vos produits sélectionnés</h2>
              <span class="helper-text" id="items-count">0 article</span>
            </div>

            <ul class="summary-list" id="summary-list" hidden></ul>

            <div class="totals-block" id="totals-block" hidden>
              <span><strong>Produits</strong><strong id="summary-subtotal">0 DA</strong></span>
              <span><strong>Livraison</strong><strong id="summary-shipping">0 DA</strong></span>
            </div>

            <p class="summary-total" id="summary-total" hidden>Total&nbsp;: 0&nbsp;DA</p>
            <p class="empty-cart-message" id="empty-cart-message">Votre panier est vide sur ce navigateur. Retournez sur la boutique pour ajouter des produits avant de finaliser votre commande.</p>
          </div>

          <input type="hidden" name="total_produits" id="hidden-total-produits">
          <input type="hidden" name="livraison" id="hidden-livraison">
          <input type="hidden" name="total_commande" id="hidden-total-commande">
          <div id="order-hidden-inputs"></div>

          <div class="submit-row">
            <button class="btn btn-principal" id="submit-order-btn" type="submit">Valider ma commande</button>
            <p class="helper-text">Un conseiller vous contactera pour confirmation et paiement.</p>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer id="contact-footer">
    <div>
      <h4>À propos</h4>
      <p>Divine Glow DZ — Boutique en ligne de cosmétiques et maquillage authentiques. Retrouvez toutes vos marques préférées, des produits de qualité, à prix abordables, avec livraison rapide partout en Algérie. ✨</p>
    </div>
    <div>
      <h4>Contact</h4>
      <a class="contact-chip" href="mailto:divineglowdz1@gmail.com">
        <svg viewBox="0 0 24 24">
          <rect x="3" y="5" width="18" height="14" rx="2.2"></rect>
          <polyline points="4 6 12 12 20 6"></polyline>
        </svg>
        <span>divineglowdz1@gmail.com</span>
      </a>
      <a class="contact-chip" href="tel:+213559764690">
        <svg viewBox="0 0 24 24">
          <path d="M5.8 2.6 8.5 3a2.2 2.2 0 0 1 1.9 1.8l.5 2.7a2.2 2.2 0 0 1-.6 1.9l-1.6 1.6a12.6 12.6 0 0 0 6.3 6.3l1.6-1.6a2.2 2.2 0 0 1 1.9-.6l2.7.5a2.2 2.2 0 0 1 1.8 1.9l.3 2.7a2.2 2.2 0 0 1-2.2 2.4A18.6 18.6 0 0 1 2.4 7.8 2.2 2.2 0 0 1 4.8 5.6l1-.3z"></path>
        </svg>
        <span>+213 55 97 64 690</span>
      </a>
      <p>Alger, Algérie</p>
    </div>
    <div>
      <h4>Restez inspirée</h4>
      <p>Inscrivez-vous pour recevoir des tutoriels exclusifs, looks backstage et offres privées.</p>
      <form>
        <input type="email" placeholder="Votre e-mail">
        <button type="submit" class="btn btn-principal" style="margin-top:12px;">Je m’inscris</button>
      </form>
    </div>
    <div>
      <h4>Suivez-nous</h4>
      <div class="social-links">
        <a class="social-icon" href="https://www.instagram.com/divineglowdz?igsh=MXc3MjBzM3lkcHpxOA%3D%3D&utm_source=qr" target="_blank" rel="noopener noreferrer">
          <svg viewBox="0 0 24 24">
            <rect x="3" y="3" width="18" height="18" rx="5"></rect>
            <circle cx="12" cy="12" r="4.5"></circle>
            <circle cx="17.5" cy="6.5" r="1.3" fill="#f8dcb7"></circle>
          </svg>
          <span>Instagram</span>
        </a>
        <a class="social-icon" href="https://www.tiktok.com/@divineglowdz?_r=1&_t=ZS-912PSkQN0cs" target="_blank" rel="noopener noreferrer">
          <svg viewBox="0 0 24 24">
            <path d="M15 3v5.6a3.8 3.8 0 0 1 3.7 3.8v1a7 7 0 0 1-5.3-2.4v6.4a4.5 4.5 0 1 1-4.5-4.5 4.4 4.4 0 0 1 1.6.3V9.1h2.9V3z"></path>
          </svg>
          <span>TikTok</span>
        </a>
      </div>
    </div>
    <p class="credits">© 2025 divine glow dz. Tous droits réservés. Brillance et bienveillance incluses.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const CART_KEY = 'lumina-cart';
      const shippingTable = {
        "Adrar": { home: 1850, desk: 850 },
        "Chlef": { home: 850, desk: 450 },
        "Laghouat": { home: 850, desk: 450 },
        "Oum El Bouaghi": { home: 850, desk: 450 },
        "Batna": { home: 850, desk: 450 },
        "Béjaïa": { home: 850, desk: 450 },
        "Biskra": { home: 850, desk: 450 },
        "Béchar": { home: 1050, desk: 450 },
        "Blida": { home: 650, desk: 450 },
        "Bouira": { home: 800, desk: 450 },
        "Tamanrasset": { home: 1850, desk: 850 },
        "Tébessa": { home: 850, desk: 450 },
        "Tlemcen": { home: 850, desk: 450 },
        "Tiaret": { home: 850, desk: 450 },
        "Tizi Ouzou": { home: 800, desk: 450 },
        "Alger": { home: 600, desk: 400 },
        "Djelfa": { home: 850, desk: 450 },
        "Jijel": { home: 850, desk: 450 },
        "Sétif": { home: 800, desk: 450 },
        "Saïda": { home: 850, desk: 450 },
        "Skikda": { home: 850, desk: 450 },
        "Sidi Bel Abbès": { home: 850, desk: 450 },
        "Annaba": { home: 850, desk: 450 },
        "Guelma": { home: 850, desk: 450 },
        "Constantine": { home: 850, desk: 450 },
        "Médéa": { home: 800, desk: 450 },
        "Mostaganem": { home: 850, desk: 450 },
        "M'Sila": { home: 850, desk: 450 },
        "Mascara": { home: 850, desk: 450 },
        "Ouargla": { home: 1050, desk: 450 },
        "Oran": { home: 800, desk: 450 },
        "El Bayadh": { home: 1050, desk: 450 },
        "Illizi": { home: 1850, desk: 850 },
        "Bordj Bou Arreridj": { home: 850, desk: 450 },
        "Boumerdès": { home: 750, desk: 450 },
        "El Tarf": { home: 850, desk: 450 },
        "Tindouf": { home: 2050, desk: 1050 },
        "Tissemsilt": { home: 850, desk: 450 },
        "El Oued": { home: 1050, desk: 450 },
        "Khenchela": { home: 850, desk: 450 },
        "Souk Ahras": { home: 850, desk: 450 },
        "Tipaza": { home: 750, desk: 450 },
        "Mila": { home: 850, desk: 450 },
        "Aïn Defla": { home: 800, desk: 450 },
        "Naâma": { home: 1050, desk: 450 },
        "Aïn Témouchent": { home: 850, desk: 450 },
        "Ghardaïa": { home: 1050, desk: 450 },
        "Relizane": { home: 850, desk: 450 },
        "El M'ghair": { home: 1050, desk: 450 },
        "El Menia": { home: 1050, desk: 450 },
        "Ouled Djellal": { home: 1050, desk: 450 },
        "Bordj Badji Mokhtar": { home: 2050, desk: 1050 },
        "Béni Abbès": { home: 1600, desk: 650 },
        "Timimoun": { home: 1600, desk: 650 },
        "Touggourt": { home: 1050, desk: 450 },
        "Djanet": { home: 2050, desk: 1050 },
        "In Salah": { home: 1850, desk: 850 },
        "In Guezzam": { home: 2050, desk: 1050 }
      };

      const summaryList = document.getElementById('summary-list');
      const summaryTotal = document.getElementById('summary-total');
      const summarySubtotal = document.getElementById('summary-subtotal');
      const summaryShipping = document.getElementById('summary-shipping');
      const totalsBlock = document.getElementById('totals-block');
      const emptyCartMessage = document.getElementById('empty-cart-message');
      const itemsCount = document.getElementById('items-count');
      const submitButton = document.getElementById('submit-order-btn');
      const hiddenInputsContainer = document.getElementById('order-hidden-inputs');
      const hiddenTotalProduits = document.getElementById('hidden-total-produits');
      const hiddenLivraison = document.getElementById('hidden-livraison');
      const hiddenTotalCommande = document.getElementById('hidden-total-commande');
      const wilayaSelect = document.getElementById('wilaya');
      const deliveryRadios = document.querySelectorAll('input[name="mode_livraison"]');

      const formatPrice = (value) => `${new Intl.NumberFormat('fr-DZ').format(value)} DA`;

      const loadCart = () => {
        const stored = localStorage.getItem(CART_KEY);
        if (!stored) return [];
        try {
          const parsed = JSON.parse(stored);
          if (Array.isArray(parsed)) {
            return parsed.map(item => ({
              id: item.id,
              name: item.name,
              price: Number(item.price) || 0,
              quantity: Number(item.quantity) || 1,
              optionLabel: item.optionLabel || 'Option unique',
              optionValue: item.optionValue || '',
              image: item.image || ''
            }));
          }
        } catch (error) {
          console.error('Erreur lors du chargement du panier :', error);
        }
        return [];
      };

      const cartItems = loadCart();

      const renderSummary = () => {
        hiddenInputsContainer.innerHTML = '';
        if (!cartItems.length) {
          summaryList.hidden = true;
          summaryTotal.hidden = true;
          totalsBlock.hidden = true;
          emptyCartMessage.hidden = false;
          itemsCount.textContent = '0 article';
          submitButton.disabled = true;
          hiddenTotalProduits.value = '';
          hiddenLivraison.value = '';
          hiddenTotalCommande.value = '';
          return;
        }

        const totalItems = cartItems.reduce((acc, item) => acc + item.quantity, 0);
        const productSubtotal = cartItems.reduce((acc, item) => acc + item.price * item.quantity, 0);

        itemsCount.textContent = `${totalItems} ${totalItems > 1 ? 'articles' : 'article'}`;
        summaryList.innerHTML = cartItems.map((item, index) => {
          const optionSnippet = item.optionLabel ? `<span>Option : ${item.optionLabel}</span>` : '';
          const quantitySnippet = `<span>Qté : ${item.quantity}</span>`;
          const priceSnippet = `<span>Prix : ${formatPrice(item.price)}</span>`;
          const imageSrc = item.image || 'https://via.placeholder.com/120?text=Produit';
          return `
            <li class="summary-item">
              <div class="summary-thumb">
                <img src="${imageSrc}" alt="${item.name}">
              </div>
              <div class="summary-info">
                <span class="summary-item-title">${item.name}</span>
                <div class="summary-meta">
                  ${optionSnippet}
                  ${quantitySnippet}
                  ${priceSnippet}
                </div>
              </div>
            </li>
          `;
        }).join('');

        summarySubtotal.textContent = formatPrice(productSubtotal);
        summaryList.hidden = false;
        totalsBlock.hidden = false;
        emptyCartMessage.hidden = true;
        submitButton.disabled = false;

        cartItems.forEach((item, index) => {
          const baseName = `items[${index}]`;
          const hiddenFields = [
            { name: `${baseName}[id]`, value: item.id },
            { name: `${baseName}[name]`, value: item.name },
            { name: `${baseName}[option]`, value: item.optionValue || item.optionLabel || '' },
            { name: `${baseName}[quantity]`, value: item.quantity },
            { name: `${baseName}[price]`, value: item.price },
            { name: `${baseName}[image]`, value: item.image || '' }
          ];

          hiddenFields.forEach(field => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = field.name;
            input.value = field.value;
            hiddenInputsContainer.appendChild(input);
          });
        });

        updateTotals();
      };

      const getSelectedDeliveryMode = () => {
        const selected = Array.from(deliveryRadios).find(radio => radio.checked);
        return selected ? selected.value : null;
      };

      const calculateShipping = () => {
        const wilaya = wilayaSelect.value;
        const mode = getSelectedDeliveryMode();
        if (!wilaya || !mode) return 0;

        const wilayaRates = shippingTable[wilaya];
        if (!wilayaRates) return 0;

        return mode === 'À domicile' ? wilayaRates.home : wilayaRates.desk;
      };

      const updateTotals = () => {
        if (!cartItems.length) return;

        const productSubtotal = cartItems.reduce((acc, item) => acc + item.price * item.quantity, 0);
        const shippingCost = calculateShipping();
        const grandTotal = productSubtotal + shippingCost;

        summaryShipping.textContent = formatPrice(shippingCost);
        summaryTotal.textContent = `Total : ${formatPrice(grandTotal)}`;
        summaryTotal.hidden = false;

        hiddenTotalProduits.value = productSubtotal;
        hiddenLivraison.value = shippingCost;
        hiddenTotalCommande.value = grandTotal;
      };

      wilayaSelect.addEventListener('change', updateTotals);
      deliveryRadios.forEach(radio => radio.addEventListener('change', updateTotals));

      renderSummary();
    });
  </script>
</body>
</html>
